(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{510:function(t,s,a){"use strict";a.r(s);var e=a(33),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"如何生成真实dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何生成真实dom"}},[t._v("#")]),t._v(" 如何生成真实DOM")]),t._v(" "),a("p",[a("a",{attrs:{href:"/dovis-blog/frame/Vue/%E8%99%9A%E6%8B%9Fdom"}},[t._v("虚拟DOM")]),t._v("最核心的部分是"),a("code",[t._v("patch")]),t._v("（patching算法），可以将"),a("code",[t._v("vnode")]),t._v("渲染成真实的"),a("code",[t._v("DOM")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"update"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update"}},[t._v("#")]),t._v(" update")]),t._v(" "),a("blockquote",[a("p",[t._v("Vue的"),a("code",[t._v("_update")]),t._v("是实例的⼀个私有⽅法，它被调⽤的时机有2个，⼀个是⾸次渲染，⼀个是数据更新的时候；由于我们这⼀章节只分析⾸次渲染部分，数据更新部分会在之后分析响应式原理的时候涉及。"),a("code",[t._v("_update")]),t._v("⽅法的作⽤是把"),a("code",[t._v("VNode")]),t._v("渲染成真实的"),a("code",[t._v("DOM")]),t._v("。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("_update")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("vnode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" VNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Component "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" prevEl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" prevVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" restoreActiveInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setActiveInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Vue.prototype.__patch__ is injected in entry points")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// based on the rendering backend used.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("prevVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// initial render")]),t._v("\n      vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__patch__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* removeOnly */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// updates")]),t._v("\n      vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__patch__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prevVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("restoreActiveInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update __vue__ reference")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prevEl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      prevEl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__vue__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__vue__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// if parent is an HOC, update its $el as well")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$vnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$parent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$vnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// updated hook is called by the scheduler to ensure that children are")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// updated in a parent's updated hook.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])]),a("h2",{attrs:{id:"patch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#patch"}},[t._v("#")]),t._v(" patch")]),t._v(" "),a("blockquote",[a("p",[t._v("patch不是暴力替换节点，而是在现有DOM上进行修改来达到渲染视图的目的。对现有DOM进行修改需要做三件事：")])]),t._v(" "),a("ul",[a("li",[t._v("创建新增的节点；")]),t._v(" "),a("li",[t._v("删除已经废弃的节点；")]),t._v(" "),a("li",[t._v("修改需要更新的节点；")])]),t._v(" "),a("ol",[a("li",[t._v("比较只会在同层级进行, 不会跨层级比较")]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("diff")]),t._v("比较的过程中，循环从两边向中间比较")])]),t._v(" "),a("h3",{attrs:{id:"新增节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增节点"}},[t._v("#")]),t._v(" 新增节点")]),t._v(" "),a("blockquote",[a("p",[t._v("只有那些因为状态的改变而新增的节点在DOM并不存在时，我们才需要创建一个节点并插入到"),a("code",[t._v("DOM")]),t._v("中。")])]),t._v(" "),a("ol",[a("li",[t._v("当"),a("code",[t._v("oldVnode")]),t._v("不存在时，直接使用vnode创建元素并渲染视图。")]),t._v(" "),a("li",[t._v("当"),a("code",[t._v("vnode")]),t._v("和"),a("code",[t._v("oldVnode")]),t._v("完全不是同一个节点时，需要使用"),a("code",[t._v("vnode")]),t._v("生成真实的"),a("code",[t._v("DOM")]),t._v("元素并将其插入到视图当中。")])]),t._v(" "),a("h3",{attrs:{id:"删除节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除节点"}},[t._v("#")]),t._v(" 删除节点")]),t._v(" "),a("blockquote",[a("p",[t._v("当一个节点只在"),a("code",[t._v("oldVnode")]),t._v("中存在时，我们需要把它从DOM节点中删除。所以vnode不存在的节点都属于被废弃的节点，而被废弃的节点需要从DOM中删除。"),a("strong",[t._v("当"),a("code",[t._v("oleVnode")]),t._v("和"),a("code",[t._v("vnode")]),t._v("完全不是同一个节点时，在DOM中需要使用vnode创建新节点替换oldVnode所对应的旧节点，而替换过程是将新创建的DOM节点插入到旧节点的旁边，然后再将旧节点删除，从而完成替换过程。")])])]),t._v(" "),a("h3",{attrs:{id:"更新节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新节点"}},[t._v("#")]),t._v(" 更新节点")]),t._v(" "),a("blockquote",[a("p",[t._v("当新旧两个节点是相同的节点时，我们需要对这两个节点进行比较细致的比对，然后对"),a("code",[t._v("oldVnode")]),t._v("在视图中所对应的真实节点进行更新。")])]),t._v(" "),a("h2",{attrs:{id:"创建节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建节点"}},[t._v("#")]),t._v(" 创建节点")]),t._v(" "),a("p",[t._v("上面是介绍了什么情况下创建元素并渲染到视图，接下来将介绍创建元素到渲染视图的过程。")]),t._v(" "),a("blockquote",[a("p",[t._v("前面介绍过vnode是有类型的，所以在创建DOM元素时，最重要的事是根据vnode类型来创建出相同类型的DOM元素，然后将元素插入到视图中。"),a("strong",[t._v("事实上只有元素节点，文本节点，注释节点会被创建并插入到DOM中")])])]),t._v(" "),a("ul",[a("li",[t._v("判断vnode是否有"),a("code",[t._v("tag")]),t._v("属性，有就是元素节点。调用当前环境下的（因为vue有两种环境，浏览器下的就是"),a("code",[t._v("document.createElement")]),t._v(")来创建真实的元素节点。当一个元素节点创建完之后，接下来的就是把它插入到指定的父节点中去。")])]),t._v(" "),a("blockquote",[a("p",[t._v("调用当前环境下的"),a("code",[t._v("appendChild")]),t._v("方法（浏览器是"),a("code",[t._v("parentNode.appendChild")]),t._v("）就可以将一个元素插入到指定父节点中。")])]),t._v(" "),a("blockquote",[a("p",[t._v("元素节点通常都有子节点（children），所以当一个元素节点被创建后，我们需要将它的子节点也创建出来并插入到这个刚创建的节点下面。创建子节点是个递归过程，把vnode的children属性循环遍历一遍，将每个子vnode都执行一次创建元素的逻辑，就可以创建子节点。")])]),t._v(" "),a("ul",[a("li",[t._v("当发现一个vnode不存在"),a("code",[t._v("tag")]),t._v("属性时，就可以判断是否存在"),a("code",[t._v("isComment")]),t._v("属性，true则为注释节点。调用当前环境下的"),a("code",[t._v("createComment")]),t._v("（浏览器下的"),a("code",[t._v("document.createComment")]),t._v("）来创建真实的注释节点并插入指定父节点中。否则调用"),a("code",[t._v("docuement.createTextNode")]),t._v("创建文本节点。")])]),t._v(" "),a("h2",{attrs:{id:"删除节点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除节点-2"}},[t._v("#")]),t._v(" 删除节点")]),t._v(" "),a("p",[t._v("详细介绍一下元素如何从视图中删除的。")]),t._v(" "),a("h2",{attrs:{id:"更新节点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新节点-2"}},[t._v("#")]),t._v(" 更新节点")]),t._v(" "),a("h3",{attrs:{id:"静态节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态节点"}},[t._v("#")]),t._v(" 静态节点")]),t._v(" "),a("blockquote",[a("p",[t._v("如果新旧两个vnode都是静态节点，那么就不需要进行更新操作，可以直接跳过更新节点的过程。"),a("strong",[t._v("静态节点就是指那些一旦渲染到界面上之后，无论日后状态如何变化，都不会发生变化的节点")])])]),t._v(" "),a("h3",{attrs:{id:"新vnode有文本属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新vnode有文本属性"}},[t._v("#")]),t._v(" 新vnode有文本属性")]),t._v(" "),a("p",[t._v("这种情况就直接调用"),a("code",[t._v("setTextContent")]),t._v("方法（浏览器下是"),a("code",[t._v("node.textContent")]),t._v("）来将"),a("strong",[t._v("视图中DOM节点内容")]),t._v("改为虚拟节点的"),a("code",[t._v("text")]),t._v("属性所保存的文字。")]),t._v(" "),a("h3",{attrs:{id:"新vnode无文本属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新vnode无文本属性"}},[t._v("#")]),t._v(" 新vnode无文本属性")]),t._v(" "),a("p",[t._v("新vnode若无文本属性，则为一个元素节点。一般元素节点会有children属性，也可能没有，所以分两种情况。")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("有children属性")]),t._v("\n这个时候就要看旧虚拟节点oldVnode是否有children属性了。如果有则要把新旧虚拟节点的子节点进行详细的对比并更新"),a("a",{attrs:{href:"#%E6%9B%B4%E6%96%B0%E5%AD%90%E8%8A%82%E7%82%B9"}},[t._v("（详细讲解）")]),t._v("；如果没有children属性，则为一个空元素节点或者为一个文本节点。如果是文本节点，则把文本清空变成空标签，然后将新vnode的children循环遍历创建成真实的DOM元素节点并插入到视图中的DOM节点下面。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("没有children属性")]),t._v("\n当新vnode没有children属性时，该新节点为一个空节点。这时旧虚拟节点oldVnode中有子节点就删除子节点，有文本就删除文本，总之有什么删除什么。")])])]),t._v(" "),a("h2",{attrs:{id:"更新子节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新子节点"}},[t._v("#")]),t._v(" 更新子节点")]),t._v(" "),a("blockquote",[a("p",[t._v("对比两个子节点列表，首先需要做的事情是循环。循环"),a("code",[t._v("newChildren")]),t._v("（新子节点列表），每循环到一个新节点，就去"),a("code",[t._v("oldChildren")]),t._v("中找到和当前节点相同的那个旧子节点。如果找不到，说明当前子节点是由于状态变化而新增的节点，我们要创建节点并插入视图中；如果找到了，就更新操作；如果找到旧子节点的位置和新子节点不同，则需要移动节点等。")])]),t._v(" "),a("ul",[a("li",[t._v("四种操作\n"),a("ul",[a("li",[t._v("更新节点")]),t._v(" "),a("li",[t._v("新增节点")]),t._v(" "),a("li",[t._v("删除节点")]),t._v(" "),a("li",[t._v("移动节点")])])])]),t._v(" "),a("h3",{attrs:{id:"更新策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新策略"}},[t._v("#")]),t._v(" 更新策略")]),t._v(" "),a("ol",[a("li",[t._v("创建子节点")])]),t._v(" "),a("p",[t._v("对于新增节点，我们需要执行创建节点的操作，并将新创建的节点插入到"),a("code",[t._v("oldChildren")]),t._v("中所有未处理节点的前面。")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("更新子节点")]),t._v(" "),a("li",[t._v("移动子节点")])]),t._v(" "),a("p",[t._v("移动节点通常发生在"),a("code",[t._v("newChildren")]),t._v("中的某个节点和"),a("code",[t._v("oldChildren")]),t._v("中的某个节点是同一个节点，但是位置不同，所以在真实的DOM中需要将这个节点的位置以新虚拟节点的位置为基准进行移动。通过"),a("code",[t._v("Node.insertBefore()")]),t._v("方法移动节点，移动的节点移动到所有未处理节点的最前面。")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("删除子节点")])]),t._v(" "),a("p",[t._v("当"),a("code",[t._v("newChildren")]),t._v("中的所有节点都循环了一遍后，也就是循环结束后，如果"),a("code",[t._v("oldChildren")]),t._v("中还有剩余的没有被处理的节点，那么这些节点就是被废弃，需要删除的节点。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("在更新子节点时，需要在"),a("code",[t._v("oldChildren")]),t._v("中循环去找一个节点。但是如果我们在模板中渲染列表时，为子节点设置了属性"),a("code",[t._v("key")]),t._v("，就会生成一个"),a("code",[t._v("key")]),t._v("对应着一个节点下标这样一个对象。也就是说，如果在节点上设置了属性"),a("code",[t._v("key")]),t._v("。那么在"),a("code",[t._v("oldChildren")]),t._v("中找相同节点时，可以直接通过"),a("code",[t._v("key")]),t._v("拿到下标，从而获取节点。这样，我们根本不需要通过循环来查找节点。")])])])}),[],!1,null,null,null);s.default=n.exports}}]);