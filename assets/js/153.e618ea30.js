(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{473:function(s,t,a){"use strict";a.r(t);var n=a(33),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"从图片剪裁聊前端文件上传相关的api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从图片剪裁聊前端文件上传相关的api"}},[s._v("#")]),s._v(" 从图片剪裁聊前端文件上传相关的API")]),s._v(" "),a("h2",{attrs:{id:"filereader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filereader"}},[s._v("#")]),s._v(" "),a("code",[s._v("FileReader")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("FileReader")]),s._v(" 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 "),a("code",[s._v("File")]),s._v(" 或 "),a("code",[s._v("Blob")]),s._v(" 对象指定要读取的文件或数据。")])]),s._v(" "),a("p",[s._v("图片剪裁首先要上传图片，这个时候可以利用"),a("code",[s._v("html5")]),s._v("的"),a("code",[s._v('<input type="file">')]),s._v("来上传图片，然后利用"),a("code",[s._v("FileReader")]),s._v("来实现异步读取文件机制。这个时候"),a("code",[s._v("File")]),s._v("对象可以是来自用户在一个"),a("code",[s._v("<input>")]),s._v("元素上选择文件后返回的"),a("code",[s._v("FileList")]),s._v("对象")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("input")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("avatar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("@change")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("selectAvatar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(":accept")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("acceptType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectAvatar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" reader "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onload")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" data\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("result\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("readAsDataURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("img",{attrs:{src:"/dovis-blog/other/31.png",alt:"img"}})]),s._v(" "),a("blockquote",[a("p",[s._v("通过 "),a("code",[s._v("FileReader")]),s._v(" 我们可以将图片文件转化成 "),a("code",[s._v("DataURL")]),s._v("，就是以 "),a("code",[s._v("data:image/png;base64")]),s._v("开头的一种"),a("code",[s._v("URL")]),s._v(",然后可以直接放在 "),a("code",[s._v("image.src")]),s._v(" 里，这样本地图片就显示出来了。")])]),s._v(" "),a("h3",{attrs:{id:"方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[s._v("#")]),s._v(" 方法")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("方法名")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("code",[s._v("abort")])]),s._v(" "),a("td",[s._v("中止读取操作")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("readAsArrayBuffer")])]),s._v(" "),a("td",[s._v("异步按字节读取文件内容，结果用"),a("code",[s._v("ArrayBuffer")]),s._v("对象表示")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("readAsBinaryString")])]),s._v(" "),a("td",[s._v("异步按字节读取文件内容，结果用文件的原始二进制串表示")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("readAsDataURL")])]),s._v(" "),a("td",[s._v("异步读取文件内容，结果用"),a("code",[s._v("data:URL")]),s._v("的字符串形式表示")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("readAsText")])]),s._v(" "),a("td",[s._v("异步按字符读取文件内容，结果用字符串形式表示")])])])]),s._v(" "),a("h3",{attrs:{id:"事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[s._v("#")]),s._v(" 事件")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("事件名")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("code",[s._v("onabort")])]),s._v(" "),a("td",[s._v("中断时触发")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("onerror")])]),s._v(" "),a("td",[s._v("出错时触发")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("onload")])]),s._v(" "),a("td",[s._v("文件读取成功完成时触发")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("onloadend")])]),s._v(" "),a("td",[s._v("读取完成触发（无论成功或失败）")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("onloadstart")])]),s._v(" "),a("td",[s._v("读取开始时触发")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("onprogress")])]),s._v(" "),a("td",[s._v("读取中")])])])]),s._v(" "),a("h2",{attrs:{id:"二进制数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二进制数组"}},[s._v("#")]),s._v(" 二进制数组")]),s._v(" "),a("blockquote",[a("p",[s._v("先来介绍"),a("code",[s._v("ArrayBuffer")]),s._v(",是因为 "),a("code",[s._v("FileReader")]),s._v(" 有个 "),a("code",[s._v("readAsArrayBuffer()")]),s._v("的方法,如果被读的文件是二进制数据,那用这个方法去读应该是最合适的,读出来的数据,就是一个 "),a("code",[s._v("Arraybuffer")]),s._v(" 对象")])]),s._v(" "),a("p",[a("code",[s._v("ArrayBuffer")]),s._v("对象，"),a("code",[s._v("TypedArray")]),s._v("视图，"),a("code",[s._v("DataView")]),s._v("视图是"),a("code",[s._v("JavaScript")]),s._v("操作二进制数据的一个接口。它们都以数组的语法处理二进制数据，所以统称二进制数组。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ArrayBuffer")]),s._v("对象：代表内存中的一段二进制数据，可以通过视图进行操作。可以用数组的方法操作内存。")]),s._v(" "),a("li",[a("code",[s._v("TypedArray")]),s._v("视图：有"),a("code",[s._v("9")]),s._v("种类型的视图，如"),a("code",[s._v("Uint8Array")]),s._v("（无符号8位整数）数组视图，"),a("code",[s._v("Int16Array")]),s._v("16位整数数组视图等。"),a("strong",[s._v("数组成员都是相同的数据类型")])]),s._v(" "),a("li",[a("code",[s._v("DataView")]),s._v("视图：可以自定义复合格式的视图，每个字节的类型都可以自定义的。意思就是数组成员可以是不同的数据类型。")])]),s._v(" "),a("p",[s._v("一言以蔽之，"),a("code",[s._v("ArrayBuffer")]),s._v("对象代表原始的二进制数据，"),a("code",[s._v("TypedArray")]),s._v("视图用于读/写简单类型的二进制数据，"),a("code",[s._v("DataView")]),s._v("视图用于读/写复杂类型的二进制数据。"),a("strong",[s._v("二进制数组不是真正的数据，而是类数组")])]),s._v(" "),a("h3",{attrs:{id:"arraybuffer对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arraybuffer对象"}},[s._v("#")]),s._v(" "),a("code",[s._v("ArrayBuffer")]),s._v("对象")]),s._v(" "),a("blockquote",[a("p",[s._v("代表存储二进制数据的一段内存，不能直接读/写，只能通过另外两个视图对象读/写，视图的作用是以指定格式解读二进制数据。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("byteLength"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ArrayBuffer 对象有实例属性 byteLength ，表示当前实例占用的内存字节长度（单位字节）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("上面代码生成一段32字节的内存区域，每个字节的值默认都是0。该对象的参数是所需要的内存大小（单位字节）")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ArrayBuffer.prototype.slice()")]),s._v("\n该方法允许将内存区域的一部分复制生成一个新的"),a("code",[s._v("ArrayBuffer")]),s._v("对象。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" newBuffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("slice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("上面代码复制了"),a("code",[s._v("buffer")]),s._v("对象的前3个字节，生成"),a("code",[s._v("newBuffer")]),s._v("一个新的"),a("code",[s._v("ArrayBuffer")]),s._v("对象。该方法其实包含了分配一段新内存，将原来的"),a("code",[s._v("ArrayBuffer")]),s._v("对象复制过去两步骤。该方法如果省略了第二个参数，则默认到原始内存对象的结尾。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ArrayBuffer.isView()")]),s._v("\n返回一个布尔值，表示参数是否为"),a("code",[s._v("ArrayBuffer")]),s._v("的视图实例。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nArrayBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// false")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Int32Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nArrayBuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("ArrayBuffer")]),s._v("对象作为内存区域，可以存放多种类型的数据。同一段内存，不同数据有不同的解读方式，这就叫做视图。")])]),s._v(" "),a("h3",{attrs:{id:"dataview视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dataview视图"}},[s._v("#")]),s._v(" "),a("code",[s._v("DataView")]),s._v("视图")]),s._v(" "),a("p",[s._v("为了读写这段内容，需要为它指定视图。"),a("code",[s._v("DataView")]),s._v("视图的创建，需要提供"),a("code",[s._v("ArrayBuffer")]),s._v("对象实例作为参数。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" dataView "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DataView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndataView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUint8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 0  因为原始内存ArrayBuffer对象默认所有位都是0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"typedarray视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#typedarray视图"}},[s._v("#")]),s._v(" "),a("code",[s._v("TypedArray")]),s._v("视图")]),s._v(" "),a("p",[a("img",{attrs:{src:"/dovis-blog/other/32.png",alt:"img"}}),s._v(" "),a("code",[s._v("TypedArray")]),s._v("视图，与"),a("code",[s._v("DataView")]),s._v("视图的一个区别是，它不是一个构造函数，而是一组构造函数，代表不同的数据格式。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" x1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Int32Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 32位带符号整数")]),s._v("\nx1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" x2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Uint8Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 8位不带符号整数")]),s._v("\nx2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\nx1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("由于两个视图对应同一段内存，因此一个视图修改底层内存会影响到另一个视图。"),a("strong",[a("code",[s._v("TypedArray")]),s._v("视图还可以接收普通数组作为参数，直接分配内存生成底层的"),a("code",[s._v("ArrayBuffer")]),s._v("实例，同时完成这段内存的赋值。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" imageData "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getDataURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" b64 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" imageData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data:image/png;base64,'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" binary "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("atob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如图乱码所以需要下一步取编码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" array "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" binary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("charCodeAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" newBlob "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Uint8Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'image/png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("上面的自己封装的头像剪裁组件例子中"),a("code",[s._v("array")]),s._v("就是普通数组，新建了一个不带符号的8位整数视图，对底层内存的赋值也同时完成。使用"),a("code",[s._v("Uint8Array")]),s._v("是因为"),a("code",[s._v("b64")]),s._v("字符串在"),a("code",[s._v("atob")]),s._v("解码后一一获得具体字符的"),a("code",[s._v("Unicode")]),s._v("编码的值范围在"),a("code",[s._v("0-255")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/dovis-blog/other/33.png",alt:"img"}})]),s._v(" "),a("ul",[a("li",[s._v("普通数组和"),a("code",[s._v("TypedArray")]),s._v("数组差异：\n"),a("ul",[a("li",[s._v("后者数组成员连续，不会有空位")]),s._v(" "),a("li",[s._v("后者数组成员默认值为0")]),s._v(" "),a("li",[s._v("后者数组所有成员都是同一种类型\n除此之外，所有在数组上使用的方法都能在其上使用。")])])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" v3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Int16Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建一个指向b的Int16视图，开始于字节2，长度为2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("视图的构造函数可以接受3个参数：")]),s._v(" "),a("ul",[a("li",[s._v("第一个参数（必选）：视图对应的底层"),a("code",[s._v("ArrayBuffer")]),s._v("对象。")]),s._v(" "),a("li",[s._v("第二个参数（可选）：视图开始的字节序号，默认从0开始。"),a("strong",[s._v("必须与所建立的数据类型一致，否则报错")])]),s._v(" "),a("li",[s._v("第三个参数（可选）：视图包含的数据个数，默认直到本段内存区域结束。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" i16 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Int16Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Uncaught RangeError: start offset of Int16Array")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// should be a multiple of 2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("上面例子新生成一个8个字节的原始内存对象，然后在这个对象的第一个字节建立带符号的16位整数视图，结果报错。因为带符号的16位整数需要2个字节，所以这就是数据类型不一致引起的报错。")]),s._v(" "),a("h2",{attrs:{id:"blob对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blob对象"}},[s._v("#")]),s._v(" Blob对象")]),s._v(" "),a("p",[a("code",[s._v("Blob")]),s._v("是用来支持文件操作的。简单的说：在JS中，有两个构造函数 "),a("code",[s._v("File")]),s._v(" 和 "),a("code",[s._v("Blob")]),s._v(", 而"),a("code",[s._v("File")]),s._v("继承了所有"),a("code",[s._v("Blob")]),s._v("的属性。\n"),a("code",[s._v("Blob")]),s._v("具体实现的功能：\n"),a("img",{attrs:{src:"/dovis-blog/other/15.jpg",alt:"img"}})]),s._v(" "),a("blockquote",[a("p",[s._v("要从其他非"),a("code",[s._v("blob")]),s._v("对象和数据构造一个 "),a("code",[s._v("Blob")]),s._v("，请使用 "),a("code",[s._v("Blob()")]),s._v("构造函数。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Blob"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("blobParts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("返回一个新创建的"),a("code",[s._v("Blob")]),s._v("对象，其内容由参数中给定定数组串联组成。")]),s._v(" "),a("ul",[a("li",[s._v("属性\n"),a("ul",[a("li",[a("code",[s._v("Blob.size")]),s._v("：只读，"),a("code",[s._v("Blob")]),s._v("对象中包含数据定大小（字节）")]),s._v(" "),a("li",[a("code",[s._v("Blob.type")]),s._v("：只读，一个字符串，表示该"),a("code",[s._v("Blob")]),s._v("对象所包含数据的"),a("code",[s._v("MIME")]),s._v("类型。如果类型未知，则为空字符串。")])])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" newBlob "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Uint8Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'image/png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newBlob"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"/dovis-blog/other/34.png",alt:"img"}})]),s._v(" "),a("ul",[a("li",[s._v("方法\n"),a("ul",[a("li",[a("code",[s._v("Blob.slice([start[,end[,contentType]]])")]),s._v("：返回一个新的"),a("code",[s._v("Blob")]),s._v("对象，包含了源"),a("code",[s._v("Blob")]),s._v("对象中指定范围内的数据。"),a("strong",[s._v("用于文件分片上传")])]),s._v(" "),a("li",[a("code",[s._v("Blob.stream()")]),s._v("：返回一个能读取"),a("code",[s._v("blob")]),s._v("内容的"),a("code",[s._v("ReadableStream")])]),s._v(" "),a("li",[a("code",[s._v("Blob.text()")]),s._v("：返回一个"),a("code",[s._v("promise")]),s._v("且包含"),a("code",[s._v("blob")]),s._v("所有内容的"),a("code",[s._v("UTF-8")]),s._v("格式的 "),a("code",[s._v("USVString")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("Blob.arrayBuffer()")]),s._v("：返回一个"),a("code",[s._v("promise")]),s._v("且包含"),a("code",[s._v("blob")]),s._v("所有内容的二进制格式的 "),a("code",[s._v("ArrayBuffer")])])])])]),s._v(" "),a("h2",{attrs:{id:"base64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#base64"}},[s._v("#")]),s._v(" base64")]),s._v(" "),a("p",[a("img",{attrs:{src:"/dovis-blog/other/35.png",alt:"img"}})]),s._v(" "),a("p",[s._v("其实就是"),a("code",[s._v("Data URI")]),s._v("，前缀为"),a("code",[s._v("data:")]),s._v("协议的"),a("code",[s._v("URL")]),s._v("，其允许内容创建者向文档嵌入小文件。"),a("code",[s._v("Data URI")]),s._v(" 由四个部分组成：前缀"),a("code",[s._v("(data:)")]),s._v("、指示数据类型的"),a("code",[s._v("MIME")]),s._v("类型、如果非文本则为可选的"),a("code",[s._v("base64")]),s._v("标记、数据本身：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("data:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mediatype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("base64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("如果数据是文本类型，你可以直接将文本嵌入 (根据文档类型，使用合适的实体字符或转义字符)。如果是二进制数据，你可以将数据进行"),a("code",[s._v("base64")]),s._v("编码之后再进行嵌入。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("data:,Hello%2C%20World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 简单的 text/plain 类型数据")]),s._v("\n\ndata:text/plain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("base64,SGVsbG8sIFdvcmxkIQ%3D%3D "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上一条示例的 base64 编码版本")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("p",[s._v("在 JavaScript 中，有两个函数被分别用来处理解码和编码"),a("code",[s._v("base64")]),s._v("字符串："),a("code",[s._v("atob()")]),s._v("和"),a("code",[s._v("btoa()")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("atob()")]),s._v(" 函数能够解码通过"),a("code",[s._v("base-64")]),s._v("编码的字符串数据。相反地，"),a("code",[s._v("btoa()")]),s._v(" 函数能够从二进制数据“字符串”创建一个"),a("code",[s._v("base-64")]),s._v("编码的"),a("code",[s._v("ASCII")]),s._v("字符串。")])]),s._v(" "),a("p",[s._v("然后取出其中"),a("code",[s._v("base64")]),s._v("信息，再用"),a("code",[s._v("window.atob")]),s._v("转换成由二进制字符串。但"),a("code",[s._v("window.atob")]),s._v("转换后的结果仍然是字符串，直接给"),a("code",[s._v("Blob")]),s._v("还是会出错。所以又要用"),a("code",[s._v("Uint8Array")]),s._v("转换一下。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("如果不仔细看，真的会误把"),a("code",[s._v("data URI")]),s._v("看成"),a("code",[s._v("data URL")]),s._v("，然后用"),a("code",[s._v("URL")]),s._v("的方式去理解"),a("code",[s._v("URI")]),s._v("，其实不然！"),a("code",[s._v("URL")]),s._v("是"),a("code",[s._v("uniform resource locator")]),s._v("的缩写，在"),a("code",[s._v("web")]),s._v("中的每一个可访问资源都有一个"),a("code",[s._v("URL")]),s._v("地址，例如图片，"),a("code",[s._v("HTML")]),s._v("文件，"),a("code",[s._v("js")]),s._v("文件以及"),a("code",[s._v("style sheet")]),s._v("文件，我们可以通过这个地址去"),a("code",[s._v("download")]),s._v("这个资源。其实"),a("code",[s._v("URL")]),s._v("是"),a("code",[s._v("URI")]),s._v("的子集，"),a("code",[s._v("URI")]),s._v("是"),a("code",[s._v("uniform resource identifier")]),s._v("的缩写。"),a("code",[s._v("URI")]),s._v("是用于获取资源，包括其附加的信息的一种协议。附加信息可能是地址，也可能不是地址，如果是地址，那么这时"),a("code",[s._v("URI")]),s._v("就变成"),a("code",[s._v("URL")]),s._v("了。注意的是"),a("code",[s._v("data URI")]),s._v("不是"),a("code",[s._v("URL")]),s._v("，因为它并不包含资源的公共地址。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// base64转换成buffer")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("base64ToBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("base64Url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" parts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" base64Url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';base64,'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// let contentType = parts[0].split(':')[1];")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" raw "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("atob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("parts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" rawLength "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" uInt8Array "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Uint8Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rawLength"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" rawLength"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        uInt8Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("charCodeAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" uInt8Array\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"canvas"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#canvas"}},[s._v("#")]),s._v(" canvas")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" canvas "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'canvas'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" context "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" canvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2d'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncontext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("drawImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// sw/sh 被剪裁图像的宽高。 dx/dy 在画布上放置的位置。 width 要使用的图像宽度")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" imageData "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" canvas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toDataURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("code",[s._v("toDataURL")]),s._v("方法返回一个包含图片展示的"),a("code",[s._v("data URI")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("canvas.toDataURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type, encoderOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("type")]),s._v("可选：图片格式，默认为"),a("code",[s._v("image/png")])]),s._v(" "),a("li",[a("code",[s._v("encoderOptions")]),s._v("可选：在指定图片格式为 "),a("code",[s._v("image/jpeg")]),s._v(" 或 "),a("code",[s._v("image/webp")]),s._v("的情况下，可以从 "),a("code",[s._v("0")]),s._v(" 到 "),a("code",[s._v("1")]),s._v(" 的区间内选择图片的质量。如果超出取值范围，将会使用默认值 "),a("code",[s._v("0.92")]),s._v("。其他参数会被忽略。")])])]),s._v(" "),a("li",[a("p",[s._v("需要注意的点：")]),s._v(" "),a("ul",[a("li",[s._v("如果画布的高度或宽度是"),a("code",[s._v("0")]),s._v("，那么会返回字符串"),a("code",[s._v("“data:,”")]),s._v("。")]),s._v(" "),a("li",[s._v("如果传入的类型非"),a("code",[s._v("“image/png”")]),s._v("，但是返回的值以"),a("code",[s._v("“data:image/png”")]),s._v("开头，那么该传入的类型是不支持的。")]),s._v(" "),a("li",[s._v("Chrome支持"),a("code",[s._v("“image/webp”")]),s._v("类型。")])])])]),s._v(" "),a("h2",{attrs:{id:"formdata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#formdata"}},[s._v("#")]),s._v(" FormData")]),s._v(" "),a("blockquote",[a("p",[s._v("提交请求有两种方式：一种是"),a("code",[s._v("Ajax")]),s._v("，另外一种就是通过表单提交\n通过"),a("code",[s._v("File API")]),s._v("能够访问到文件内容，利用这一点就可以通过"),a("code",[s._v("XHR")]),s._v("直接把文件上传到服务器。当然啦，把文件内容放到"),a("code",[s._v("send()")]),s._v("方法中，再通过"),a("code",[s._v("POST")]),s._v("请求，的确很容易就能实现上传。但这样做传递的是文件内容，因而服务器必须收集提交的内容，然后再把它们保存到另一个文件中。其实更好的做法是以表单提交的方式来上传文件。")])]),s._v(" "),a("p",[s._v("这时候裁剪后的文件就储存在"),a("code",[s._v("blob")]),s._v("里了,我们可以把它当作是普通文件一样，加入到"),a("code",[s._v("FormData")]),s._v("里，并上传至服务器了。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" fd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FormData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'file'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);